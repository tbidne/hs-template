<div align="center">

# hs-template

[![GitHub release (latest SemVer)](https://img.shields.io/github/v/release/tbidne/hs-template?include_prereleases&sort=semver)](https://github.com/tbidne/hs-template/releases/)
![haskell](https://img.shields.io/static/v1?label=&message=9.4&logo=haskell&logoColor=655889&labelColor=2f353e&color=655889)
[![MIT](https://img.shields.io/github/license/tbidne/hs-template?color=blue)](https://opensource.org/licenses/MIT)

[![nix](http://img.shields.io/github/actions/workflow/status/tbidne/hs-template/nix.yaml?branch=main&label=nix&logo=nixos&logoColor=85c5e7&labelColor=2f353c)](https://github.com/tbidne/hs-template/actions/workflows/nix.yaml)
[![cabal](http://img.shields.io/github/actions/workflow/status/tbidne/hs-template/cabal.yaml?branch=main&label=cabal&labelColor=2f353c)](https://github.com/tbidne/hs-template/actions/workflows/cabal.yaml)
[![stack](http://img.shields.io/github/actions/workflow/status/tbidne/hs-template/stack.yaml?branch=main&label=stack&logoColor=white&labelColor=2f353c)](https://github.com/tbidne/hs-template/actions/workflows/stack.yaml)
[![style](http://img.shields.io/github/actions/workflow/status/tbidne/hs-template/style.yaml?branch=main&label=style&logoColor=white&labelColor=2f353c)](https://github.com/tbidne/hs-template/actions/workflows/style.yaml)

</div>

---

### Table of Contents
- [Introduction](#introduction)
- [Structure](#structure)
  - [Haskell](#haskell)
    - [Cabal](#cabal)
    - [Stack](#stack)
    - [HS Misc](#hs-misc)
  - [Nix](#nix)
  - [CI](#ci)
  - [misc](#misc)

# Introduction

`hs-template` is a template for haskell projects with `cabal`, `stack` and `nix` integration.

# Structure

## Haskell

* `app/`: Haskell executable code. This should be as light as possible, ideally one small module (`Main.hs`), maybe two (e.g. `Args.hs` for CLI args).
* `src/`: Haskell library code. Whether the application is an executable or library, most of the logic should go here.

* `hs-template.cabal`: The primary file used for building a project. This should always be in version control even if the primary build tool is `stack`.

### Cabal

* `cabal.project`: This project adds additional options that are used at build time. Here we use it to turn various warnings on.

### Stack

* `stack.yaml / stack.yaml.lock`: These files are used for building with stack, with the latter generated by `stack build`. `stack.yaml` is analogous to `cabal.project.`

### HS Misc

* `hie.yaml`: This file helps with IDE integration via the `haskell-language-server`.
* `CHANGELOG.md`

## Nix

* `flake.nix / flake.lock`: For `nix` users. A nix shell can be entered with `nix develop` that will give the tools necessary for haskell development with `cabal`. Cabal can be traded for `stack` if desired.

* `nix/cabal.nix`: Minimal nix setup, just `cabal`, `ghc`, and optional dev tools. Useful for testing specific ghc versions.
* `nix/stack.nix`: Allows one to load a shell with `stack` and `ghc`.

## CI

* `.github/workflows/`: Several github actions are defined that verify:
  * Build / Tests with `cabal` and multiple ghc versions.
  * Build / Tests with `stack` and multiple snapshots.
  * Build / Test with nix directly (i.e. `nix build`).
  * Linting (e.g. formatting).

## Misc

* `Makefile`: A makefile that provides useful shortcuts for cabal commands. For example, the most common `cabal` commands are provided, along with multiple formatters/linters. The formatting/linting uses tools from https://github.com/tbidne/nix-hs-tools and requires nix. If this is not desired, they can be changed to use the tool directly e.g.

    ```Makefile
    # from
    formatc:
      nix run github:tbidne/nix-hs-tools/0.7#cabal-fmt -- --check ;\
      nix run github:tbidne/nix-hs-tools/0.7#ormolu -- --mode check ;\
      nix run github:tbidne/nix-hs-tools/0.7#nixpkgs-fmt -- --check

    # to
    formatc:
      cabal-fmt --check hs-template.cabal ;\
      find . -type f -name '*.hs' | xargs ormolu --mode check
      nixpkgs-fmt . --check
    ```

    And of course they can be deleted/swapped out as desired.